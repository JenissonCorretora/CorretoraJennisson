<div class="conversas-list">
  <div class="conversas-header">
    <h2>Conversas</h2>
  </div>

  <div class="conversas-content">
    @if (loading()) {
    <div class="loading-state">
      <span class="material-icons">hourglass_top</span>
      <p>Carregando conversas...</p>
    </div>
    } @else if (conversas().length === 0) {
    <div class="empty-state">
      <span class="material-icons">chat_bubble_outline</span>
      <p>Nenhuma conversa ainda</p>
    </div>
    } @else {
    @for (conversa of conversas(); track conversa.usuarioId) {
    <div class="conversa-item"
         [class.active]="selectedUsuarioId === conversa.usuarioId"
         (click)="selectConversa(conversa.usuarioId)">
      <div class="conversa-avatar">
        <span class="material-icons">account_circle</span>
      </div>
      <div class="conversa-info">
        <div class="conversa-header-row">
          <h3 class="conversa-nome">{{ conversa.usuarioNome }}</h3>
          @if (conversa.ultimaMensagem) {
          <span class="conversa-time">{{ formatDate(conversa.ultimaMensagem.created_At) }}</span>
          }
        </div>
        <div class="conversa-preview-row">
          @if (conversa.assunto) {
          <p class="conversa-assunto">{{ conversa.assunto }}</p>
          } @else {
          <p class="conversa-preview">{{ getPreviewText(conversa.ultimaMensagem?.conteudo || '') }}</p>
          }
          @if (conversa.naoLidas > 0) {
          <span class="badge">{{ conversa.naoLidas }}</span>
          }
        </div>
        <div class="conversa-dados">
          @if (conversa.usuarioEmail) {
          <p class="conversa-email">{{ conversa.usuarioEmail }}</p>
          }
          @if (conversa.usuarioTelefone) {
          <p class="conversa-telefone">{{ conversa.usuarioTelefone }}</p>
          }
        </div>
      </div>
    </div>
    }
    }
  </div>
</div>

